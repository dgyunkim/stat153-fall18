)
pred4 <- predict(model_4, newdata = new_dat)
pred4
CVs
CVs <- matrix(0, nrow = 4, ncol = 19)
CVs[1, (i - 11)] <- sum((test - pred1)^2)
CVs[2, (i - 11)] <- sum((test - pred2)^2)
CVs[3, (i - 11)] <- sum((test - pred3)^2)
CVs[4, (i - 11)] <- sum((test - pred4)^2)
CVs
i = 19
t <- 1:(12*i)
t_nxt <- (12*i+1):(13*i)
train <- subset(birth, start = 1, end = 12*i)
test <- subset(birth, start = 12*i+1, end = 13*i)
pred1 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1)$pred
pred2 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1,
P = 1, D = 1, Q = 1, S = 12)$pred
pred3 <- sarima.for(train, n.ahead = 12, p = 2, d = 1, q = 2,
P = 1, D = 1, Q = 1, S = 12)$pred
dat <- data.frame(
train = train,
t = t,
tt = t^2,
ttt = t^3,
season = seasonaldummy(train)
)
model_4 <- lm(train ~ ., data = dat)
new_dat <- data.frame(
t = t_nxt,
tt = t_nxt^2,
ttt = t_nxt^3,
season = seasonaldummy(test)
)
pred4 <- predict(model_4, newdata = new_dat)
pred4
test
test <- subset(birth, start = (12*i)+1, end = 13*i)
test
train
t_nxt
length(t_nxt)
t <- 1:(12*i)
t_nxt <- (12*i+1):(12*(i+1))
t_nxt
length(t_nxt)
CVs <- matrix(0, nrow = 4, ncol = 19)
for (i in 12:30) {
t <- 1:(12*i)
t_nxt <- (12*i+1):(12*(i+1))
train <- subset(birth, start = 1, end = 12*i)
test <- subset(birth, start = (12*i)+1, end = 12*(i+1))
pred1 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1)$pred
pred2 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1,
P = 1, D = 1, Q = 1, S = 12)$pred
pred3 <- sarima.for(train, n.ahead = 12, p = 2, d = 1, q = 2,
P = 1, D = 1, Q = 1, S = 12)$pred
dat <- data.frame(
train = train,
t = t,
tt = t^2,
ttt = t^3,
season = seasonaldummy(train)
)
model_4 <- lm(train ~ ., data = dat)
new_dat <- data.frame(
t = t_nxt,
tt = t_nxt^2,
ttt = t_nxt^3,
season = seasonaldummy(test)
)
pred4 <- predict(model_4, newdata = new_dat)
CVs[1, (i - 11)] <- sum((test - pred1)^2)
CVs[2, (i - 11)] <- sum((test - pred2)^2)
CVs[3, (i - 11)] <- sum((test - pred3)^2)
CVs[4, (i - 11)] <- sum((test - pred4)^2)
}
train
test
CVs
rownames(CVs) <- paste("Model", 1:4)
CVs
colnames(CVs) <- 1961:1979
CVs
?appply
?apply
apply(CVs, 1, mean)
apply(CVs, 1, mean)
model_a <- birth
plot(model_a)
par(mfrow = c(1, 2))
acf(model_a)
pacf(model_a)
par(mfrow = c(2, 1))
acf(model_b)
pacf(model_b)
par(mfrow = c(2, 1))
acf(model_a)
pacf(model_a)
par(mfrow = c(2, 1))
acf(model_c)
pacf(model_c)
library(astsa)
library(TSA)
library(forecast)
model_a <- birth
plot(model_a)
par(mfrow = c(2, 1))
acf(model_a)
pacf(model_a)
library(astsa)
library(TSA)
library(forecast)
model_a <- birth
plot(model_a)
par(mfrow = c(1, 2))
acf(model_a)
pacf(model_a)
knitr::opts_chunk$set(echo = TRUE)
library(astsa)
library(forecast)
data("AirPassengers")
```{r}
plot(AirPassengers)
#First of all, it looks like the variance increases with the mean. Since this is count data, we try a square transform to stabilize the variance.
plot(sqrt(AirPassengers))
#Still looks like variance depends on mean. Try log transform.
plot(log(AirPassengers))
#This looks good.
logair <- log(AirPassengers)
#SARIMA processes are stationary after differencing, so we need to difference appropriately until the process has constant mean and no seasonal component in the plot.
plot(logair)
#The plot strongly suggest some linear trend in time. Use first-differencing to handle it.
air1 <- diff(logair,lag=1)
plot(air1)
#There still seems to be a yearly trend. Concretely, "air1" can thought of as the change in the month to month change in passenger count, and it seems the month-month change has a yearly trend. Further difference by 12.
air2 <- diff(air1,lag=12)
plot(air2)
#Now, we try to identify what type of SARIMA process we're dealing with
acf2(air2)
#Method 1. Using the original log data
sarima(logair,p=0,d=1,q=0,P=0,D=1,Q=1,S=12)
#Method 2. Using the year-differenced, first-differenced
sarima(air2,p=0,d=0,q=0,P=0,D=0,Q=1,S=12)
#Method 1. Using the original log data
sarima(logair,p=0,d=1,q=0,P=0,D=1,Q=1,S=12)
#Using this intution, let's look at the PACF/ACF at lags between 0 and 1(ie. within a year). One possible interpretation is that the ACF cuts off at lag 3, and the PACF tapers. This suggests a MA(3) process.
model1 <-sarima(logair,p=0,d=1,q=3,P=0,D=1,Q=1,S=12)
birth
birth[1, 1]
?sarima.for()
i = 12
t <- 1:(12*i)
t_nxt <- (12*i+1):(12*(i+1))
train <- subset(birth, start = 1, end = 12*i)
test <- subset(birth, start = (12*i)+1, end = 12*(i+1))
pred1 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1, details = FALSE)$pred
pred1
CVs
rownames(CVs) <- paste("Model", 1:4)
colnames(CVs) <- 1960:1978
CVs
78-59
train
str(train)
i = 20
t <- 1:(12*i)
t_nxt <- (12*i+1):(12*(i+1))
train <- subset(birth, start = 1, end = 12*i)
test <- subset(birth, start = (12*i)+1, end = 12*(i+1))
pred1 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1)$pred
pred2 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1,
P = 1, D = 1, Q = 1, S = 12)$pred
pred3 <- sarima.for(train, n.ahead = 12, p = 2, d = 1, q = 2,
P = 1, D = 1, Q = 1, S = 12)$pred
dat <- data.frame(
train = train,
t = t,
tt = t^2,
ttt = t^3,
season = seasonaldummy(train)
)
model_4 <- lm(train ~ ., data = dat)
new_dat <- data.frame(
t = t_nxt,
tt = t_nxt^2,
ttt = t_nxt^3,
season = seasonaldummy(test)
)
pred4 <- predict(model_4, newdata = new_dat)
test
pred1
test
i = 12
t <- 1:(12*i)
t_nxt <- (12*i+1):(12*(i+1))
train <- subset(birth, start = 1, end = 12*i)
test <- subset(birth, start = (12*i)+1, end = 12*(i+1))
pred1 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1)$pred
pred2 <- sarima.for(train, n.ahead = 12, p = 1, d = 1, q = 1,
P = 1, D = 1, Q = 1, S = 12)$pred
pred3 <- sarima.for(train, n.ahead = 12, p = 2, d = 1, q = 2,
P = 1, D = 1, Q = 1, S = 12)$pred
dat <- data.frame(
train = train,
t = t,
tt = t^2,
ttt = t^3,
season = seasonaldummy(train)
)
model_4 <- lm(train ~ ., data = dat)
new_dat <- data.frame(
t = t_nxt,
tt = t_nxt^2,
ttt = t_nxt^3,
season = seasonaldummy(test)
)
pred4 <- predict(model_4, newdata = new_dat)
test
pred1
test
data.frame(t = t)
data.frame(t = t, I(t^2) = t^2)
new_dat
new_dat
model_4
model_4
new_dat
CVs
19060:1978
1960:1978
# model 1
m1 <- sarima(birth, p = 1, d = 1, q = 1)
library(astsa)
dat <- birth
plot(dat)
plot(dat, ylab = "Birth (thousands)", main = "Time Series Plot")
plot(dat, ylab = "Birth (thousands)", main = "Time Series Plot", las = 1)
diff_dat <- diff(birth)
plot(diff_dat)
plot(diff_dat, ylab = "Differenced Birth", main = "Differenced Time Series Plot")
acf(diff_dat)
pacf(diff_dat)
acf(diff_dat, main = "ACF Plot of Differenced Series")
pacf(diff_dat, main = "PACF Plot of Differenced Series")
seas_diff_dat <- diff(diff_dat, lag = 12)
plot(seas_diff_dat)
plot(seas_diff_dat, ylab = "Seasonal Difference of Differenced Time Series Plot")
plot(seas_diff_dat, main = "Seasonal Difference of Differenced Time Series Plot")
plot(seas_diff_dat, main = "Seasonal Difference of Differenced Time Series Plot", ylab = "Seasonal Difference of Differenced Birth")
pacf(seas_diff_dat)
acf(seas_diff_dat)
acf(seas_diff_dat)
pacf(seas_diff_dat)
acf(seas_diff_dat, main = "ACF Plot of Seasonal Difference of Differenced Series")
pacf(seas_diff_dat, main = "ACF Plot of Seasonal Difference of Differenced Series")
sarima(dat, p = 1, d = 1, q = 1)
sarima1 <- sarima(dat, p = 1, d = 1, q = 1)
sarima2 <- sarima(dat, p = 1, d = 1, q = 1, P = 1, D = 1, Q = 1)
sarima2 <- sarima(dat, p = 1, d = 1, q = 1, P = 1, D = 1, Q = 1, S = 12)
sarima3 <- sarima(dat, p = 2, d = 1, q = 2, P = 1, D = 1, Q = 1, S = 12)
AIC <- c(sarima1$AIC, sarima2$AIC)
AIC
sarima1$AIC
AIC <- c(sarima1$AIC, sarima2$AIC, sarima3$AIC)
names(AIC) <- paste("Model", 1:3)
AIC
min(AIC)
AIC[which.min(AIC)]
AICc <- c(sarima1$AICc, sarima2$AICc, sarima3$AICc)
AICc <- c(sarima1$AICc, sarima2$AICc, sarima3$AICc)
names(AICc) <- paste("Model", 1:3)
AICc
AICc[which.min(AIC)]
AICc <- c(sarima1$AICc, sarima2$AICc, sarima3$AICc)
names(AICc) <- paste("Model", 1:3)
AICc
AICc[which.min(AICc)]
BIC <- c(sarima1$BIC, sarima2$BIC, sarima3$BIC)
names(BIC) <- paste("Model", 1:3)
BIC
BIC[which.min(BIC)]
t <- time(dat)
library(forecast)
dummies <- seasonaldummy(dat)
t
t2 <- t^2
t3 <- t^3
lm4 <- (dat ~ t + t2 + t3 + dummies)
lm4
lm4 <- lm(dat ~ t + t2 + t3 + dummies)
lm4
t <- 1:length(dat)
t2 <- t^2
t3 <- t^3
dummies <- seasonaldummy(dat)
lm4 <- lm(dat ~ t + t2 + t3 + dummies)
lm4
dat
birth
nrow(birth)
legnth(birth)
length(birth)
dat <- birth[-373]
dat
372/12
i <- 13
n <- i * 12
birth
i = 12
n <- i * 12
dat_temp <- dat[1:n]
dat <- birth[1:n]
n <- i * 12
t <- 1:n
dat <- birth[t]
dat
birth
window(birth, start = 1, end = 144)
window(birth, start = c(1948, 1), end = c(1958, 12))
dat <- window(birth, start = c(1948, 1), end = c(1947 + i, 12)
}
n <- i * 12
t <- 1:n
t2 <- t^2
t3 <- t^3
dat <- window(birth, start = c(1948, 1), end = c(1947 + i, 12)
ddd
dat <- window(birth, start = c(1948, 1), end = c(1947 + i, 12))
dat
dummies <- seasonaldummy(dat)
?arima
m1 <- arima(dat, order = c(1, 1, 1))
m2 <- arima(dat, order = c(1, 1, 1), seasonal = list(order = c(1, 1, 1), period = 12))
m3 <- arima(dat, order = c(2, 1, 2), seasonal = list(order = c(1, 1, 1), period = 12))
m4 <- lm(dat ~ t + t2 + t3 + dummies)
predict1 <- predict(m1, n.ahead = 12)
predict1
predict1 <- predict(m1, n.ahead = 12)$pred
predict2 <- predict(m2, n.ahead = 12)$pred
predict3 <- predict(m3, n.ahead = 12)$pred
t_new <- (n+1):(n+12)
t_new
t
m4
?lm
?predict
t2
dummies
dummies[1:12]
dummies[1:12, 1:12]
dummies[1:144]
dummies[1:12, ]
predict4 <- predict(m4,
newdata = data.frame(t = t_new,
t2 = t_new^2,
t3 = t_new^3,
dummies = dummies[1:12, ]))
t
t_new
new_dat <- data.frame(
t = t_new,
t2 = t_new^2,
t3 = t_new^3,
dummies = dummies[1:12, ]
)
new_dat
predict4 <- predict(m4, newdata = new_dat)
lm4
m4
new_dat
dummies[1:12, ]
names(new_dat)
names(new_dat)[4:]
names(new_dat)[4:14]
m4$coefficients
names(m4$coefficients)
names(m4$coefficients)[5:15]
names(new_dat)[4:14] <- names(m4$coefficients)[5:15]
predict1 <- predict(m1, n.ahead = 12)$pred
predict2 <- predict(m2, n.ahead = 12)$pred
predict3 <- predict(m3, n.ahead = 12)$pred
predict4 <- predict(m4, newdata = new_dat)
new_dat
nrow(new_dat)
lmdat <- data.frame(
t = t
t2 = t^2,
lmdat <- data.frame(
t = t,
t2 = t^2,
t3 = t^3,
dummies = dummies
)
lmdat
lmdat <- data.frame(
dat = dat,
t = t,
t2 = t^2,
t3 = t^3,
dummies = dummies
)
lmdat
m4 <- lm(dat ~ ., data = lmdat)
m4
new_lmdat <- data.frame(
t = t_new,
t2 = t_new^2,
t3 = t_new^3,
dummies = dummies[1:12, ]
)
new_lmdat
i = 12
n <- i * 12
t <- 1:n
t_new <- (n+1):(n+12)
t2 <- t^2
t3 <- t^3
dat <- window(birth, start = c(1948, 1), end = c(1947 + i, 12))
dummies <- seasonaldummy(dat)
lmdat <- data.frame(
dat = dat,
t = t,
t2 = t^2,
t3 = t^3,
dummies = dummies
)
new_lmdat <- data.frame(
t = t_new,
t2 = t_new^2,
t3 = t_new^3,
dummies = dummies[1:12, ]
)
m1 <- arima(dat, order = c(1, 1, 1))
m2 <- arima(dat, order = c(1, 1, 1), seasonal = list(order = c(1, 1, 1), period = 12))
m3 <- arima(dat, order = c(2, 1, 2), seasonal = list(order = c(1, 1, 1), period = 12))
m4 <- lm(dat ~ ., data = lmdat)
predict1 <- predict(m1, n.ahead = 12)$pred
predict2 <- predict(m2, n.ahead = 12)$pred
predict3 <- predict(m3, n.ahead = 12)$pred
predict4 <- predict(m4, newdata = new_dat)
predict4 <- predict(m4, newdata = new_lmdat)
predict4
predict1
predict2
predict3
predict4
30 - 11
MSE <- matrix(0, nrow = 4, ncol = 19)
MSE
rownames(MSE) <- paste("Model", 1:4)
MSE
colnames(MSE) <- 1960:1978
birth
MSE
true <- window(birth, start = c(1947 + i, 1), end = c(1947 + i, 12))
true
true <- window(birth, start = c(1948 + i, 1), end = c(1948 + i, 12))
true
character(1)
character(12)
as.character(12)
MSE[1, "1960"]
MSE[1, "1961"]
MSE[1, "1959"]
MSE[1, as.character(1948 + i)] <- sum((predict1 - true)^2)
MSE
MSE[2, as.character(1948 + i)] <- sum((predict2 - true)^2)
MSE[3, as.character(1948 + i)] <- sum((predict3 - true)^2)
MSE[4, as.character(1948 + i)] <- sum((predict4 - true)^2)
MSE
for (i in 12:30){
n <- i * 12
t <- 1:n
t_new <- (n+1):(n+12)
t2 <- t^2
t3 <- t^3
dat <- window(birth, start = c(1948, 1), end = c(1947 + i, 12))
dummies <- seasonaldummy(dat)
lmdat <- data.frame(
dat = dat,
t = t,
t2 = t^2,
t3 = t^3,
dummies = dummies
)
new_lmdat <- data.frame(
t = t_new,
t2 = t_new^2,
t3 = t_new^3,
dummies = dummies[1:12, ]
)
m1 <- arima(dat, order = c(1, 1, 1))
m2 <- arima(dat, order = c(1, 1, 1), seasonal = list(order = c(1, 1, 1), period = 12))
m3 <- arima(dat, order = c(2, 1, 2), seasonal = list(order = c(1, 1, 1), period = 12))
m4 <- lm(dat ~ ., data = lmdat)
predict1 <- predict(m1, n.ahead = 12)$pred
predict2 <- predict(m2, n.ahead = 12)$pred
predict3 <- predict(m3, n.ahead = 12)$pred
predict4 <- predict(m4, newdata = new_lmdat)
true <- window(birth, start = c(1948 + i, 1), end = c(1948 + i, 12))
MSE[1, as.character(1948 + i)] <- sum((predict1 - true)^2)
MSE[2, as.character(1948 + i)] <- sum((predict2 - true)^2)
MSE[3, as.character(1948 + i)] <- sum((predict3 - true)^2)
MSE[4, as.character(1948 + i)] <- sum((predict4 - true)^2)
}
MSE
apply(MSE, 1, mean)
CV <- apply(MSE, 1, mean)
CV
min(CV)
CV[which.min(CV)]
